<html>
	<head>
		<title>
		</title>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
		<script>
			var util = (function() {

				function equilateralBToH(b) {
					return Math.floor(Math.sqrt(3) * b / 2);
				}

				return {
					equilateralBToH: equilateralBToH
				}
			})();

			Function.prototype.inheritsFrom = function( parentClassOrObject ){ 
				if ( parentClassOrObject.constructor == Function ) 
				{ 
					//Normal Inheritance 
					this.prototype = new parentClassOrObject;
					this.prototype.constructor = this;
					this.prototype.parent = parentClassOrObject.prototype;
				} 
				else 
				{ 
					//Pure Virtual Inheritance 
					this.prototype = parentClassOrObject;
					this.prototype.constructor = this;
					this.prototype.parent = parentClassOrObject;
				} 
				return this;
			} 

			// invoke parent constructor of this
			function Super(obj) {
				if (obj.parent) return obj.parent.constructor;
			}

			function CanvasState(canvas) {
				this.canvas = canvas;
				this.width = canvas.width;
				this.height = canvas.height;
				this.ctx = canvas.getContext('2d');

				this.valid = false; // when set to true, canvas will redraw
				this.shapes = [];
				this.interval = 30; // redraw time

				var self = this;

				// redraw
				setInterval(function() {
					self.draw();	
				}, self.interval);
			}

			CanvasState.prototype.draw = function() {
				if (!this.valid)  {
					var ctx = this.ctx;
					var shapes = this.shapes;
					this.clear();

					for (var i = 0 ; i < shapes.length; i++) {
						var shape = shapes[i];
						if (shape.x > this.width || shape.y > this.height ||
							shape.x + shape.w < 0 || shape.y + shape.h < 0) continue;

						shapes[i].draw(ctx);
					}
					// draw selection
				    // right now this is just a stroke along the edge of the selected Shape
				    if (this.selection != null) {
				      ctx.strokeStyle = this.selectionColor;
				      ctx.lineWidth = this.selectionWidth;
				      var mySel = this.selection;
				      ctx.strokeRect(mySel.x,mySel.y,mySel.w,mySel.h);
				    }

				    this.valid = true;
				}
			}

			CanvasState.prototype.addShape = function(shape) {
			  this.shapes.push(shape);
			  this.valid = false;
			}

			CanvasState.prototype.clear = function() {
			  this.ctx.clearRect(0, 0, this.width, this.height);
			}

			// Triangle
			function Shape(x, y, b, color, num) {
				this.x = x || 0;
				this.y = y || 0;
				this.b = b || 1;
				this.h = Math.floor(Math.sqrt(3) * b / 2);
				this.color = color || '#8e44ad';
				this.num = num || 0;
			}
			Shape.prototype.draw = function(ctx) {
				ctx.fillStyle = this.color;
				ctx.beginPath();
				ctx.moveTo(this.x + 0, this.y + 0);
				ctx.lineTo(this.x + this.b, this.y);
				ctx.lineTo(this.x + (this.b/2), this.y + this.h);
				ctx.fill();

				ctx.fillStyle = "white";
				ctx.font = "12px Arial";
				ctx.fillText(this.num, this.x + this.b/2 - 6, this.y + this.h/2 + 12);
			}

			// Upside Down Triangle
			Triangle.inheritsFrom(Shape);
			// Constructor
			function Triangle(x, y, b, color, num) {
				// Invoke Super
				Super(this).call(this, x, y, b, color, num);
			}
			Triangle.prototype.draw = function(ctx) {
				ctx.fillStyle = this.color;
				ctx.beginPath();
				ctx.moveTo(this.x + 0, this.y + this.h);
				ctx.lineTo(this.x + this.b, this.y + this.h);
				ctx.lineTo(this.x + (this.b/2), this.y + 0);
				ctx.fill();

				ctx.fillStyle = "white";
				ctx.font = "12px Arial";
				ctx.fillText(this.num, this.x + this.b/2 - 6, this.y + this.h/2 +12);
			}

			$(document).ready(function() {


				var s = new CanvasState(document.getElementById('game'));
				var TRIANGLES_PER_ROW = 8;
				var NUM_ROWS = 10;
				var TRIANGLE_LENGTH = 100;
				var ROW_OFFSET = util.equilateralBToH(TRIANGLE_LENGTH);
				for (var j = 0; j < NUM_ROWS ; j++) {
					var upTriangleLeftOffset = 0;
					var downTriangleLeftOffset = 0;
					if (j % 2 == 0) {
						upTriangleLeftOffset = TRIANGLE_LENGTH/2;
					} else {
						downTriangleLeftOffset = TRIANGLE_LENGTH/2;
					}
					for (var i = -1 ; i < TRIANGLES_PER_ROW; i++) {
						s.addShape(new Shape(upTriangleLeftOffset + i*TRIANGLE_LENGTH , j*ROW_OFFSET, TRIANGLE_LENGTH, null,2*i+1));
						s.addShape(new Triangle(downTriangleLeftOffset + i*TRIANGLE_LENGTH, j*ROW_OFFSET, TRIANGLE_LENGTH, "#28b162", 2*i));
					}
				}
			});
		</script>
		<style>
		</style>
	</head>
	<body>
		<canvas id="game" width="800" height="600">
			This text is displayed if your browser does not support HTML5 Canvas.
		</canvas>
	</body>
</html>